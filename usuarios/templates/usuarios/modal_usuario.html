<!-- Modal mejorado para agregar/editar usuario -->
<div id="modalUsuario" class="modal" style="display:none;">
  <div class="modal-overlay"></div>
  <div class="modal-content-enhanced">
    <div class="modal-header-enhanced">
      <div class="modal-icon">
        <!-- Icono de usuario -->
        <svg width="24" height="24" fill="none" viewBox="0 0 24 24">
          <circle cx="12" cy="8" r="4" fill="#fff" opacity="0.7"/>
          <path d="M4 20c0-2.67 5.33-4 8-4s8 1.33 8 4v1H4v-1z" fill="#fff" opacity="0.7"/>
          <circle cx="12" cy="8" r="4" stroke="#0066ff" stroke-width="2"/>
          <path d="M4 20c0-2.67 5.33-4 8-4s8 1.33 8 4v1H4v-1z" stroke="#0066ff" stroke-width="2"/>
        </svg>
      </div>
      <h2 id="modalUsuarioTitulo" class="modal-title-enhanced">Nuevo Usuario</h2>
      <button type="button" class="modal-close-enhanced" id="cerrarModal">
        <svg width="20" height="20" fill="none" viewBox="0 0 20 20">
          <path d="M15 5L5 15M5 5l10 10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>

    <form id="usuarioForm" method="post" action="/usuarios/crear/" class="form-enhanced">
      {% csrf_token %}
      <div class="form-body-enhanced">
        <div id="usuarioFormFields" class="form-fields-grid">
          
          <!-- Campo Nombre de Usuario -->
          <div class="form-group-enhanced">
            <label for="nombre_usuario" class="form-label-enhanced">
              <svg width="16" height="16" fill="none" viewBox="0 0 24 24" class="label-icon">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" fill="currentColor"/>
              </svg>
              Nombre de Usuario
              <span class="required-asterisk">*</span>
            </label>
            <div class="input-wrapper-enhanced">
              <input 
                type="text" 
                id="nombre_usuario" 
                name="nombre_usuario" 
                class="form-input-enhanced" 
                placeholder="Ingresa el nombre de usuario"
                required
                autocomplete="username"
              >
              <div class="input-focus-border"></div>
            </div>
            <div class="form-error" id="error_nombre_usuario"></div>
          </div>

          <!-- Campo Correo Electrónico -->
          <div class="form-group-enhanced">
            <label for="correo" class="form-label-enhanced">
              <svg width="16" height="16" fill="none" viewBox="0 0 24 24" class="label-icon">
                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z" fill="currentColor"/>
              </svg>
              Correo Electrónico
              <span class="required-asterisk">*</span>
            </label>
            <div class="input-wrapper-enhanced">
              <input 
                type="email" 
                id="correo" 
                name="correo" 
                class="form-input-enhanced" 
                placeholder="usuario@ejemplo.com"
                required
                autocomplete="email"
              >
              <div class="input-focus-border"></div>
            </div>
            <div class="form-error" id="error_correo"></div>
          </div>

          <!-- Campo Contraseña -->
          <div class="form-group-enhanced">
            <label for="password" class="form-label-enhanced">
              <svg width="16" height="16" fill="none" viewBox="0 0 24 24" class="label-icon">
                <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z" fill="currentColor"/>
              </svg>
              Contraseña
              <span class="required-asterisk">*</span>
            </label>
            <div class="input-wrapper-enhanced password-wrapper">
              <input 
                type="password" 
                id="password" 
                name="password" 
                class="form-input-enhanced" 
                placeholder="Mínimo 8 caracteres"
                required
                autocomplete="new-password"
              >
              <button type="button" class="password-toggle" id="togglePassword">
                <svg width="16" height="16" fill="none" viewBox="0 0 24 24" class="eye-icon">
                  <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z" fill="currentColor"/>
                </svg>
              </button>
              <div class="input-focus-border"></div>
            </div>
            <div class="password-strength" id="passwordStrength">
              <div class="strength-bar">
                <div class="strength-fill"></div>
              </div>
              <span class="strength-text">Ingresa una contraseña</span>
            </div>
            <div class="form-error" id="error_password"></div>
          </div>

          <!-- Campo Rol -->
          <div class="form-group-enhanced">
            <label for="rol" class="form-label-enhanced">
              <svg width="16" height="16" fill="none" viewBox="0 0 24 24" class="label-icon">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" fill="currentColor"/>
              </svg>
              Rol
              <span class="required-asterisk">*</span>
            </label>
            <div class="select-wrapper-enhanced">
              <select id="rol" name="rol" class="form-select-enhanced" required>
                <option value="">Selecciona un rol</option>
                {% for rol in roles %}
                  <option value="{{ rol.nombre|lower }}">{{ rol.nombre|title }}</option>
                {% endfor %}
              </select>
              <div class="select-arrow">
                <svg width="12" height="12" fill="none" viewBox="0 0 24 24">
                  <path d="M7 10l5 5 5-5z" fill="currentColor"/>
                </svg>
              </div>
              <div class="input-focus-border"></div>
            </div>
            <div class="form-error" id="error_rol"></div>
          </div>

        </div>
      </div>

      <div class="form-actions-enhanced">
        <button type="button" class="btn-cancelar-enhanced" id="cancelarModal">
          <svg width="16" height="16" fill="none" viewBox="0 0 24 24">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z" fill="currentColor"/>
          </svg>
          Cancelar
        </button>
        <button type="submit" class="btn-guardar-enhanced" id="guardarUsuario">
          <svg width="16" height="16" fill="none" viewBox="0 0 24 24">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="currentColor"/>
          </svg>
          <span class="btn-text">Guardar Usuario</span>
          <div class="btn-loading">
            <div class="spinner"></div>
            Guardando...
          </div>
        </button>
      </div>
    </form>
  </div>
</div>
